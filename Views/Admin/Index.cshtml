@model IEnumerable<CourseProject.ViewModels.UserViewModel>
@{
    ViewData["Title"] = "Users management";
}
<h2>User management</h2>
<form asp-action="ApplyAction" asp-controller="Admin" method="post" id="admin-form">
    @Html.AntiForgeryToken()
    <div id="error-alert" class="alert alert-danger d-none mt-3" role="alert">
        Please select at least one user.
    </div>
    <div class="mb-3">
        <div class="dropdown">
            <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                    aria-expanded="false">
                Actions
            </button>
            <ul class="dropdown-menu">
                <li>
                    <button type="submit" name="action" value="Block" class="dropdown-item">Block</button>
                </li>
                <li>
                    <button type="submit" name="action" value="Unblock" class="dropdown-item">Unblock</button>
                </li>
                <li>
                    <button type="submit" name="action" value="AssignAdmin" class="dropdown-item">Assign as Admin
                    </button>
                </li>
                <li>
                    <button type="submit" name="action" value="RemoveAdmin" class="dropdown-item">Remove Admin Role
                    </button>
                </li>
                <li>
                    <button type="submit" name="action" value="Delete" class="dropdown-item">Delete</button>
                </li>
            </ul>
        </div>
    </div>
    <input type="hidden" name="action" id="action-input"/>
    <table class="table table-striped table-responsive">
        <thead>
        <tr>
            <th><input type="checkbox" id="selectAll"/></th>
            <th>Name</th>
            <th>Email</th>
            <th>Status</th>
            <th>Role</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var user in Model)
        {
            <tr>
                <td><input type="checkbox" name="userIds" value="@user.Id"/></td>
                <td>@user.Name</td>
                <td>@user.Email</td>
                <td>@(user.IsLocked ? "Blocked" : "Active")</td>
                <td>@(user.IsAdmin ? "Admin" : "User")</td>
            </tr>
        }
        </tbody>
    </table>
</form>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('selectAll').addEventListener('change', function () {
            document.querySelectorAll('input[name="userIds"]').forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });

        document.querySelectorAll('.action-button').forEach(button => {
            button.addEventListener('click', function () {
                const form = document.querySelector('form[action="/Admin/ApplyAction"]');
                const actionInput = document.getElementById('action-input');
                actionInput.value = this.dataset.action;
                form.dispatchEvent(new Event('submit'));
            });
        });

        const form = document.querySelector('form[action="/Admin/ApplyAction"]');
        if (form) {
            form.addEventListener('submit', function (e) {
                if (!document.querySelectorAll('input[name="userIds"]:checked').length) {
                    e.preventDefault();
                    const alert = document.getElementById('error-alert');
                    alert.classList.remove('d-none');
                    setTimeout(() => alert.classList.add('d-none'), 3000);
                }
            });
        }
    });
</script>